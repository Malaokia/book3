<html>
<head>
  <title>Google Book Zayo</title>
    <style>
        .answer {
            min-height: 50px
        }
        section{
          padding: 10px;
          margin-bottom: 12px
        }
        #title {
          position: absolute;
          padding: 20px;
          font-size: 64px;
          font-weight: bolder;
          color: white;
          top: 50px;
          left: 0px;
          text-shadow: -2px 0 black, 0 2px black, 5px 0 black, 0 -2px black
        }
        #title .authors {
          padding: 20px;
          font-size: 32px;
          font-weight: bolder;
          color: #DDD;
          text-shadow: -1px 0 black, 0 1px black, 1px 0 black, 0 -1px black
        }
        #tweets {
          min-height: 300px;
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.1/css/materialize.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.9.1/styles/tomorrow.min.css">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/chartist/0.9.4/chartist.min.css">
</head>
<body>
  <div class="parallax-container"  style="height:500px">
    <div class="parallax">
      <img src="http://ibandwidth.net/wp-content/uploads/2013/04/ZAYO_Group_SPOT.jpg">
      <h1 id="title">Zayo
        <div class="authors">by Andrew Linenfelser, Zach Lamb, Ming Liew </div>
      </h1>
    </div>
  </div>
  <div class="section white container flow-text">
      <div class="switch">
        Source Code
        <label>
          <input type="checkbox">
          <span class="lever"></span>
        </label>
      </div>
      <div id="questions" class="col s10 collection">
      </div>
  </div>
  <script src="https://cdn.firebase.com/js/client/2.3.1/firebase.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/3.10.1/lodash.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.1/js/materialize.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.10.6/moment.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/0.3.5/marked.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.9.1/highlight.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/chartist/0.9.4/chartist.min.js"></script>
  <script>
function toggleSourecode(){
  $('pre').each(function(){
    if ($(this).height()){
        $(this).attr('data-height', $(this).height())
        $(this).height(0)
    } else {
      $(this).height($(this).attr('data-height'))
    }
  })
}
$('.switch input').click(toggleSourecode)
function csv2jsonProfile(rawdata){
  console.log('converting csv to json array')
  var lines = rawdata.trim().split('\n')
  var rows = _.rest(lines)
  return _.map(rows, function(row){
    var toks = row.split(',')
    return {ID: toks[0], Industry: toks[1], Vertical: toks[2], Total: toks[3]+toks[4],
      Product_A_Rank: toks[5], Product_A_Total_BRR: toks[6], Product_B_Rank: toks[7],
      Product_B_Total_BRR: toks[8], Product_C_Rank: toks[9], Product_C_Total_BRR: toks[10],
      Product_D_Rank: toks[11], Product_D_Rank_BRR: toks[12], Product_E_Rank: toks[13],
      Product_F_Metro_Rank: toks[14] }
  })
}
function csv2jsonAccount(rawdata){
  console.log('converting csv to json array')
  var lines = rawdata.trim().split('\n')
  var rows = _.rest(lines)
  return _.map(rows, function(row){
    var toks = row.split(',')
    return {ID: toks[0], Service_Count: toks[1], Service_ID: toks[2], Product: toks[3],
      Total_MRR: toks[4], Term: toks[5], Bandwidth: toks[6],
      State_A: toks[7], State_Z: toks[8]}
  })
}

var items
//REPLACE WITH ZAYO CSV FILE
$.ajax({url: 'http://localhost:8081/data/CUProject-CustomerAccount.csv'})
 .done(function(rawdata){
  account_item = csv2jsonAccount(rawdata)
  console.log('number of account loaded:', account_item.length)
  console.log('Account:', account_item[0])
  $.ajax({url: 'http://localhost:8081/data/CUProject-CustomerProfile.csv'})
   .done(function(rawdata){
    profile_item = csv2jsonProfile(rawdata)
    console.log('number of profile loaded:', profile_item.length)
    console.log('Profile:', profile_item[0])
    analyze()
    })
 })
 .fail(function(err){
     console.error(err)
 })
function ask(text, func){
  var answer = func(items)
  // html element to display the answer
  var answerHtml = '<div class="collection-item answer">' +
      '<h4>' + text + '</h4>' +
      '<div>' + answer + '</div>' +
      '<pre><code>' + func.toString() + '</code></pre>' +
    '</div>'
  // append to #quetions
  $('#questions').append(answerHtml)
}
function analyze(){
  ask("What's the relation between BRR and the Bandwidth and terms", func1)
  ask('question2', func2)
  ask('question3', func3)
  $('pre code').each(function(i, block) {
    hljs.highlightBlock(block);
  })
  toggleSourecode()
}
function func1(){
  var products=_.groupBy(profile_item, function(g){
    return g.Industry
  })
  var key = _.map(products, function(x,k){
   return k
  })
  var s = _.map(products, function(x,k){
    var sum = 0
    _.forEach(x, function(s){
      var a =parseInt(s['Total'].split("$")[1].split('.')[0].split(',').join(''));
      sum = sum+ a;
    })
   return sum
  })
  console.log(s)
  console.log(key)
  var result = ''
  var ctr = 0
  _.forEach(key,function(x){
    result += x + " : " + s[ctr] + ' ; '
    ctr++
  })
  return result
}
function func2(){
  var productC = _.groupBy(account_item,function(d){
      return d['Product C Rank']
  })
  sorted = _.sortByOrder(productC,"desc")
  result = _.toArray(arguments).slice(1)
  if(result.length == 0){
    return 'none'
  }
  else{
    return result
  }
}
function func3(){
  return '...'
}
// initialize the parallax effect
$(document).ready(function(){
    $('.parallax').parallax()
})
</script>
</body>
</html>
